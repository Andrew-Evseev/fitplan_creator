# Инструкция по настройке Supabase для FitPlan Creator

## Шаг 1: Применение миграций базы данных

1. Откройте Supabase Dashboard: http://YOUR_SERVER_IP:8000
2. Войдите с учетными данными:
   - Логин: supabase
   - Пароль: YOUR_SUPABASE_PASSWORD
3. Перейдите в раздел **SQL Editor**
4. Откройте файл `supabase/migrations/000_apply_all_migrations.sql`
5. Скопируйте весь SQL код и вставьте в редактор
6. Нажмите **Run** для выполнения миграции

Миграция создаст:
- ✅ Все необходимые таблицы (profiles, user_preferences, workout_plans, workout_history, user_stats, user_settings)
- ✅ Функции и триггеры для автоматического создания профиля при регистрации
- ✅ RLS политики для безопасности данных
- ✅ Индексы для оптимизации запросов

## Шаг 2: Создание Storage Bucket (опционально)

Если нужно загружать аватары пользователей:

1. В Supabase Dashboard перейдите в **Storage**
2. Создайте новый bucket с именем `avatars`
3. Установите публичный доступ (если нужно)

## Шаг 3: Установка зависимостей Flutter

```bash
flutter pub get
```

## Шаг 4: Проверка конфигурации

Убедитесь, что переменные окружения установлены:
- SUPABASE_URL: URL вашего Supabase сервера
- SUPABASE_ANON_KEY: Anon Key из Supabase Dashboard

См. файл `.env.example` для примера конфигурации.

## Шаг 5: Запуск приложения

```bash
flutter run
```

## Проверка работы

### Тест регистрации:
1. Откройте приложение
2. Перейдите на экран авторизации
3. Нажмите "Зарегистрироваться"
4. Заполните форму:
   - Имя
   - Email
   - Пароль (минимум 6 символов)
   - Подтверждение пароля
5. Нажмите "Зарегистрироваться"

### Тест входа:
1. Введите email и пароль зарегистрированного пользователя
2. Нажмите "Войти"

### Тест сохранения предпочтений:
1. После входа пройдите анкету
2. Заполните все поля
3. Предпочтения автоматически сохранятся в Supabase

### Тест сохранения плана:
1. Сгенерируйте план тренировок
2. План автоматически сохранится в Supabase через PlannerProvider

## Проверка в Supabase Dashboard

1. Откройте **Table Editor** в Supabase Dashboard
2. Проверьте таблицы:
   - `profiles` - должны появиться профили пользователей
   - `user_preferences` - должны появиться предпочтения после заполнения анкеты
   - `workout_plans` - должны появиться планы тренировок
   - `workout_history` - должны появиться записи истории тренировок
   - `user_stats` - должна обновляться статистика пользователей

## Возможные проблемы

### Ошибка подключения к Supabase
- Проверьте, что Supabase запущен на сервере
- Проверьте URL в конфигурации
- Проверьте Anon Key

### Ошибки RLS (Row Level Security)
- Убедитесь, что миграции применены правильно
- Проверьте, что пользователь авторизован
- Проверьте RLS политики в Supabase Dashboard

### Ошибки при сохранении данных
- Проверьте структуру JSON в полях `preferences_data` и `plan_data`
- Убедитесь, что все обязательные поля заполнены
- Проверьте логи в консоли приложения

## Контакты для поддержки

При возникновении проблем проверьте:
1. Логи приложения в консоли
2. Логи Supabase в Dashboard
3. SQL Editor для проверки данных в БД
